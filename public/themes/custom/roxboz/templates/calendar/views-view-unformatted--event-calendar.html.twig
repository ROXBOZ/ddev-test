{% set weekdays = {
  monday: [],
  tuesday: [],
  wednesday: [],
  thursday: [],
  friday: []
} %}

{% set now = "now"|date('U') %}

{% for row in rows %}
  {% set event_entity = row.content['#row']._entity %}
  {% set event_day = event_entity.field_day.value|lower %}
  {% set start_time = event_entity.field_starting_time.value|date('U') %}
  {% set end_time = event_entity.field_ending_time.value|date('U') %}
  
  {% if event_day in (weekdays|keys) and now >= start_time and now <= end_time %}
    {% set weekdays =
      weekdays|merge({
        (event_day): weekdays[event_day]|merge([row])
      })
    %}
  {% endif %}
{% endfor %}

<div class="calendar">
  <div class="calendar__header">
    <div class="calendar__day-header">Monday</div>
    <div class="calendar__day-header">Tuesday</div>
    <div class="calendar__day-header">Wednesday</div>
    <div class="calendar__day-header">Thursday</div>
    <div class="calendar__day-header">Friday</div>
  </div>

  <div class="calendar__body">
    {% for day_name, events in weekdays %}
      <div class="calendar__column">
        {% if events %}
          {% set sorted_events = events|sort((a, b) => a.content['#row']._entity.field_starting_time.value <=> b.content['#row']._entity.field_starting_time.value) %}
          {% for event in sorted_events %}
            <div {{ event.attributes.addClass('calendar__event') }}>
              {{ event.content }}
            </div>
          {% endfor %}
        {% else %}
          <div class="calendar__no-events">No events</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>
